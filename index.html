<!DOCTYPE html>
<html>
<head>
	<meta charset = "utf-8">
	<meta name = "description" content = "VolChat is a simple chat application which uses node.js. This chat application can be easily implemented. This chat application does not store messages.">
	<meta name=viewport content="width=device-width, initial-scale=1">
	<title>VolChat - Home</title>
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script type="text/javascript" src = "https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script type="text/javascript" src = "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
    <script type="text/javascript">
        var socketio = io.connect("https://vol-chat.herokuapp.com"),
        	uname,
        	loggedin = 0;

        /* Utility functions */

        function hasWhiteSpace(str) {
			return /\s/g.test(str);
		}

		function hasLowerCaseNum(str) {

			var lowCaseTest = /[a-z]/;
			var numTest = /[0-9]/;

			for (var i = 0; i < str.length; i++) {
				if(!lowCaseTest.test(str[i]) && !numTest.test(str[i])){
					return 0;
				}
			};
		    return 1;
		}

        /* Utility functions end*/

        socketio.on("avail_stat", function(data) {
        	document.getElementById("available").innerHTML = data['message'];
		});

        $(document).ready(function(){
        	$("#uname_sub").on("click", function() {
				if(!loggedin){    
				    uname = document.getElementById("user_name").value;

				    if(uname.length == 0){
			    		msg = "Username mandatory. Try again.";
			    		document.getElementById("available").innerHTML = msg;
			    	}else{
			    		if(hasWhiteSpace(uname)){
			    			msg = "Username cannot have white spaces. Try again.";
			    			document.getElementById("available").innerHTML = msg;
			    		}else{
			    			if(!hasLowerCaseNum(uname)){
			    				msg = "Username should only contain lower case alphabets. Try again.";
			    				document.getElementById("available").innerHTML = msg;
			    			}else{
			    				msg = "Checking... Please wait";
					    		socketio.emit("avail_stat_chk", { "uname" : uname});
					    		document.getElementById("available").innerHTML = msg;		    				
			    			}
			    		}
			    	}
			    }else{
			    	msg = "You're already logged in. User ID: " + uname;
			    	document.getElementById("available").innerHTML = msg;
			    }
			    document.getElementById("user_name").value = "";
			});
       	});

       	socketio.on("loggedin_event_fetch", function(data) {
       		loggedin = 1;
		    socketio.emit("loggedin", { "uname" : uname});
		    setTimeout(function(){
		    	window.location = "/chat";
		    }, 2000);
		});
    </script>
</head>
<body>
	<div class = "container">
		<div class = "alert alert-info">
			<p><b>VolChat</b> is a free and open source chatting application that can be easily integrated on a website. This application <b>does not</b> store any chat data.</p>
			<p>This is just an example of how the chat will look like.</p>
			<p>The users here are stored in an array but in reality this is not practical. You might import the user details from a database.</p>
			<p>The main aim of this project is to demonstrate the idea of volatile chat, hence the name <b>VolChat</b></p><br>
			<a href="https://github.com/itsSayantan"><button type = "button" class = "btn btn-primary">Sayantan Ghosh</button></a>
			<a href="https://github.com/itsSayantan/volchat"><button type = "button" class = "btn btn-primary">Github Link</button></a>
		</div>
		<div class = "jumbotron">
			<h2>Join Chat</h2>
			<div class = "form">
				<div class = "form-group">
					<label for = "user_name">Username</label>
					<input type = "text" id = "user_name" class = "form-control" placeholder = "Enter Username">
				</div>
				<button type = "submit" id = "uname_sub" class = "btn btn-primary">Check Availability</button>
			</div>
			<span id = "available">Type a username and check if it is available.</span>
		</div>
	</div>
</body>
</html>
